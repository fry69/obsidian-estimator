# Project: Obsidian Release Queue Estimator

## Project Overview

This project is a web-based dashboard for tracking and estimating review times
for Obsidian community plugin and theme submissions. It provides insights into
the current queue sizes, estimated wait times, and historical data on pull
request merge rates.

The frontend is built with **React**, **Vite**, and **Tailwind CSS**, using
**Chart.js** for data visualization and **TanStack Query** for data fetching.

The backend is a **Cloudflare Worker** written in TypeScript that serves the
frontend and provides a JSON API. The worker fetches data from the GitHub API,
processes it, and stores the resulting payload in **Cloudflare KV**. A cron
trigger is configured to periodically update the data.

## Building and Running

### Installation

To install the dependencies, run:

```bash
npm install
```

### Local Development

To run the application in development mode, which includes hot-reloading, use:

```bash
npm run dev
```

This will start the Vite development server for the frontend and the Cloudflare
Worker in a local environment, it will run continuously until stopped via
`Ctrl+C` or typing 'q` plus enter in the running terminal. The actual URL for
the worker frontend will be displayed in the terminal. You will likely have MCP
playwright enabled to access it.

Linting can be performed with:

```bash
npm run lint
```

Type checking can be performed with the build command:

```bash
npm run build
```

Format all files with:

```bash
npm run format
```

Check for unusued code and dependencies with:

```bash
npm run knip
```

Run the whole suite of checks with:

```bash
npm run check
```

### Deployment

To deploy a staging version of the application to Cloudflare, run:

```bash
npm run deploy:staging
```

This will build the application and deploy the worker and static assets to
Cloudflare in the staging environment.

## Development Conventions

- **Language:** The project is written in **TypeScript**.
- **Frontend:** The frontend code is located in the `src` directory. The main
  application component is `src/App.tsx`.
- **Backend:** The backend Cloudflare Worker code is in `worker/index.ts`. This
  file defines the API routes (`/api/summary`, `/api/data/*`, `/api/trigger`)
  and the cron job for fetching data from GitHub.
- **Styling:** **Tailwind CSS** is used for styling. Configuration is in
  `tailwind.config.js`.
- **API:** The backend exposes a JSON API. The routes are defined in
  `worker/api.ts` using the `URLPattern` API.
- **Storage:** Queue state is saved in Cloudflare KV as two keys: a lightweight
  summary (totals, wait estimates, chart data, version metadata) and the full PR
  details blob. The ingest worker computes both and only rewrites the large
  details payload when GitHub data changes.

**IMPORTANT:**

- Never modify `worker-configuration.d.ts` directly, as it is auto-generated by
  the Cloudflare Workers tooling based on `wrangler.jsonc`. Run
  `npm run cf-typegen` to regenerate it after making changes to
  `wrangler.jsonc`. This also applies to environment variables, those are
  defined in `.dev.vars` and also get picked up automatically by the typegen
  script. Add/remove/change env vars there.
- Never modify `package-lock.json` directly. It is auto-generated by npm to lock
  dependency versions. Run `npm install` to update it after changing
  dependencies in `package.json`.

**Modern Node.js (>= 22, version 25.x currently installed) Notes:**

- Type stripping is supported natively. To run TypeScript directly, use e.g.
  `node ./scripts/some-script.ts` without needing to compile first.
- Dotenv support is built-in. Use:
  ```
  --env-file=...           set environment variables from supplied file
  --env-file-if-exists=... set environment variables from supplied file if it exists
  ```
  when running node scripts to load env vars from a file.
